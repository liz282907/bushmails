# bushmails visualization
> bush's mails project主要是通过bush从1999年到2006年的4G邮件信息从中提取出关系网络和兴趣图谱，暂时post上部分程序。

1. **mail**文件夹存放的是可视化程序，借助d3.js绘制
  - 随年份滑动动态加载数据，数据是本地的，非服务器请求数据
  - 各年份不同，chord图重新绘制，同时更新右上角的颜色图例的值
2. **others**文件夹存放的是辅助程序，如原始csv文件——>d3所需要的matrix的csv的转换
3. **data pretreatement**存放的是数据预处理的程序，主要是根据邮件信息（从数据库中读取的），建立关于人名的倒排索引。
  处理原理是：对数据库中的200万封邮件，每封提取出content，然后预处理（词干还原、归并、分词），与人名词典匹配，计算每一个人名所在的mail-id、
  在该封邮件的位置数组、频次，然后更新该人名的总邮件频次。建立倒排索引。
  
  经历以下几个艰难的过程= =
  - 存放进数据库：pass.
    建立人名倒排时每次都得查找倒排表，然后更新，读写频繁。中途微改进：用了dict存放人名-id的映射，按id查找，也将它写入了中间表
    万一中断，可以从中间表加载然后继续添加。但是读写依然很慢。且由于人名词典的不靠谱...出现了很多如"message"这样的"人名"，position数组太大了，超过了mysql
    的text记录长度65536...（而且还是在只有几万邮件的情况下）.
  - 写入文件：pass.
    将存放进数据库的倒排表写入文件中，解决了读写速度慢的问题.但导致每个文件很庞大，内存堪忧。
    微改进：每10万封建立一个倒排表，然后20个倒排表两两合并。o(m+n)的时间复杂度。速度很快没错。但是最终的文件还是很大，kill掉了
  - 写入文件：
    与上面不同的是，这次对每10万封邮件处理时，建立一个dic1的文件夹，这个文件夹中存有两部分内容：
     - 一个name-mailcount的倒排表
     - 每个人名所对应的文件夹，里面存放每一封邮件处理完得到的倒排信息（**待更改**，时间久了忘记细节了..）
    导致的问题是文件数目很多，节点不够...后来按照年份来处理数据了...
  ![2006年的可视化图](http://#/15-12-27/79392630.jpg)
  
    
